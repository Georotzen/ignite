<h2>JSMachine</h2>

<p>TODO: Insert intro here</p>

<h3>JSMachine.createFactory(sm_desc, imports, options)</h3>

<p>Create a state machine factory based on the specified description.
<code>sm_desc</code> is a description function or object, <code>imports</code> is an
object containing asynchronous functions that need to be available
through the <code>fire</code> object within the state machine and <code>options</code>
is an optional options object.</p>

<p>This function returns a JSMFactory object.</p>

<h4>Possible options</h4>

<table>
<thead>
<tr>
<th align="left">Option      </th>
<th align="left">Type       </th>
<th align="left">Description                              </th>
<th align="left">Default   </th>
</tr>
</thead>
<tbody>
<tr>
<td align="left">strict      </td>
<td align="left">Boolean    </td>
<td align="left">Make state machine strict &ndash; i.e cause to exit with an error if an unexpected event is received</td>
<td align="left">false</td>
</tr>
<tr>
<td align="left">logLevel    </td>
<td align="left">Number     </td>
<td align="left">Numerical level to alter amount of info sent to logging. Higher is more info. </td>
<td align="left">1</td>
</tr>
<tr>
<td align="left">logPrefix   </td>
<td align="left">String     </td>
<td align="left">String to prefix to log output           </td>
<td align="left">&ldquo;JSM&rdquo;+name</td>
</tr>
<tr>
<td align="left">logStream   </td>
<td align="left">WriteStream</td>
<td align="left">Where to write the log output.           </td>
<td align="left">stdout</td>
</tr>
<tr>
<td align="left">logFn       </td>
<td align="left">Function   </td>
<td align="left">Function to use to output log.           </td>
<td align="left">see code</td>
</tr>
<tr>
<td align="left">trackLevel  </td>
<td align="left">Number     </td>
<td align="left">Numerical level to indicate how much information to track. </td>
<td align="left">2</td>
</tr>
<tr>
<td align="left">trackHistLen</td>
<td align="left">Number     </td>
<td align="left">Number of old (exited) state machines to keep in history list.</td>
<td align="left">4</td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
</tbody>
</table>


<h3>JSMFactory</h3>

<p>The main function of a JSMFactory object is to create and start new
state machines on demand, and track their progress. However, it also
allows state machines to be drawn, compiled and verified.</p>

<p>A JSMFactory is an EventEmitter.</p>

<h4>JSMFactory.spawn([arg0], [arg1], &hellip;)</h4>

<p>This creates and starts a new state machine. This returns a JSM object
which is an EventEmitter.</p>

<h4>JSMFactory.spawn_with_callback([arg0], [arg1], &hellip;, [argN], callback)</h4>

<p>This creates and starts a new state machine and automatically registers
a callback to call on the state machine exiting (either via the <code>@exit</code> or
<code>@error</code> states).</p>

<h4>Event: &lsquo;entry&rsquo;</h4>

<p><code>function (id, sm) {}</code></p>

<p>This event is emitted when a new state machine is created.</p>

<h4>Event: &lsquo;exit&rsquo;</h4>

<p><code>function (id, sm) {}</code></p>

<p>This event is emitted when a state machine exits through the <code>@exit</code> state.</p>

<h4>Event: &lsquo;error&rsquo;</h4>

<p><code>function (id, sm) {}</code></p>

<p>This event is emitted when a state machine exits through the <code>@error</code> state.</p>

<h4>Event: &lsquo;quiet&rsquo;</h4>

<p><code>function () {}</code></p>

<p>This event is emitted when all state machines have exited (i.e. none are
running).</p>

<h4>Event: &lsquo;threshold&rsquo;</h4>

<p><code>function (count, dir) {}</code></p>

<p>This is emitted when the number of state machines reaches a threshold value
set with <code>JSMFactory.setThreshold()</code>.</p>

<h4>JSMFactory.setThreshold(count, [dir])</h4>

<p>Add a threshold to the list of threshold checked every time a state machine
is created or exits. Multiple thresholds can be set, but they must have
different <code>count</code> values.</p>

<p><code>count</code> is the count of state machines on which to emit the event. <code>dir</code>
indicates whether the event should fire when the count increase to the
specified count (<code>dir=1</code>), or drops to it (<code>dir=-1</code>) or either direction
(<code>dir=0</code>, default).</p>

<h4>JSMFactory.clearThreshold(count)</h4>

<p>Remove a threshold value.</p>

<h4>JSMFactory.compile([options])</h4>

<p>Create an optimised, compiled <code>JSMFactory</code>.</p>

<h4>JSMFactory.compileToFile([options])</h4>

<p>Create an optimised, compiled <code>JSMFactory</code> and write it as code to
a file.</p>

<h4>JSMFactory.verify([options])</h4>

<h3>JSM</h3>

<h4>Event: &lsquo;start&rsquo;</h4>

<p><code>function (id) {}</code></p>

<p>A state machine has started.</p>

<h4>Event: &lsquo;event&rsquo;</h4>

<p><code>function (id, evtname, args) {}</code></p>

<p>Emitted when a state machine receives an event.</p>

<h4>Event: &lsquo;change&rsquo;</h4>

<p><code>function (id, newstate, oldstate) {}</code></p>

<p>Emitted when a state machine changes state.</p>

<h4>Event: &lsquo;call&rsquo;</h4>

<p><code>function (id, type, fn) {}</code></p>

<p>Emitted when a state machine calls a state machine function.</p>

<h4>Event: &lsquo;exit&rsquo;</h4>

<p><code>function (id, args) {}</code></p>

<p>Emitted when a state machine exits into the <code>@exit</code> state.</p>

<h4>Event: &lsquo;error&rsquo;</h4>

<p><code>function (id, args) {}</code></p>

<p>Emitted when a state machine exits into the <code>@error</code> state.</p>

<h4>JSM.inject(evtname, args)</h4>

<p>Directly inject an event into a state machine. Not recommended!</p>

<h2>JSMGraph</h2>

<h4>JSMGraph.draw(jsmfactory, callback)</h4>

<h4>JSMGraph.draw(jsmfactory, options, callback)</h4>

<h4>JSMGraph.draw_to_file(jsmfactory, filename)</h4>

<h4>JSMGraph.draw_to_file(jsmfactory, options, filename)</h4>

<p>Draw the state machine.</p>

<p>In the case of <code>JSMGraph.draw()</code> the callback is called with the data for
the diagram. <code>JSMGraph.drawToFile()</code> is a helper function which automatically
writes the data to a file.</p>

<p>Options can be specified, including changing the diagram generator.</p>

<h4>Event: &lsquo;&rsquo;</h4>

<p><code>function () {}</code></p>
