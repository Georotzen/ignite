## JSMachine

TODO: Insert intro here


### JSMachine.createFactory(sm_desc, imports, options)

Create a state machine factory based on the specified description.
`sm_desc` is a description function or object, `imports` is an
object containing asynchronous functions that need to be available
through the `fire` object within the state machine and `options`
is an optional options object.

This function returns a JSMFactory object.

#### Possible options

Option      |Type       |Description                              |Default   
:-----------|:----------|:----------------------------------------|:---------
strict      |Boolean    |Make state machine strict - i.e cause to exit with an error if an unexpected event is received|false
logLevel    |Number     |Numerical level to alter amount of info sent to logging. Higher is more info. |1
logPrefix   |String     |String to prefix to log output           |"JSM"+name
logStream   |WriteStream|Where to write the log output.           |stdout
logFn       |Function   |Function to use to output log.           |see code
trackLevel  |Number     |Numerical level to indicate how much information to track. |2
trackHistLen|Number     |Number of old (exited) state machines to keep in history list.|4


### JSMFactory

The main function of a JSMFactory object is to create and start new
state machines on demand, and track their progress. However, it also
allows state machines to be drawn, compiled and verified.

A JSMFactory is an EventEmitter.


#### JSMFactory.spawn([arg0], [arg1], ...)

This creates and starts a new state machine. This returns a JSM object
which is an EventEmitter.

#### JSMFactory.spawn_with_cb([arg0], [arg1], ..., [argN], callback)

This creates and starts a new state machine and automatically registers
a callback to call on the state machine exiting (either via the `@exit` or
`@error` states).


#### Event: 'entry'

`function (id, sm) {}`

This event is emitted when a new state machine is created.

#### Event: 'exit'

`function (id, sm) {}`

This event is emitted when a state machine exits through the `@exit` state.

#### Event: 'error'

`function (id, sm) {}`

This event is emitted when a state machine exits through the `@error` state.

#### Event: 'quiet'

`function () {}`

This event is emitted when all state machines have exited (i.e. none are
running).

#### Event: 'threshold'

`function (count, dir) {}`

This is emitted when the number of state machines reaches a threshold value
set with `JSMFactory.setThreshold()`.


#### JSMFactory.setThreshold(count, [dir])

Add a threshold to the list of threshold checked every time a state machine
is created or exits. Multiple thresholds can be set, but they must have
different `count` values.

`count` is the count of state machines on which to emit the event. `dir`
indicates whether the event should fire when the count increase to the
specified count (`dir=1`), or drops to it (`dir=-1`) or either direction
(`dir=0`, default).

#### JSMFactory.clearThreshold(count)

Remove a threshold value.

#### JSMFactory.compile([options])

Create an optimised, compiled `JSMFactory`.

#### JSMFactory.compileToFile([options])

Create an optimised, compiled `JSMFactory` and write it as code to
a file.


#### JSMFactory.verify([options])




### JSM

#### Event: 'enter'

`function (id) {}`

A state machine has been entered.

#### Event: 'event'

`function (id, evtname) {}`

Emitted when a state machine receives an event.

#### Event: 'change'

`function (id, newstatename, oldstatename) {}`

Emitted when a state machine changes state.

#### Event: 'call'

`function (id, type, fn) {}`

Emitted when a state machine calls a state machine function.

#### Event: 'eemit'

`function (name, occurrence) {}`

Emitted on a change in the event emitter list - occurrence is
"register", "deregister", or "auto deregister".

#### Event: 'exit'

`function (id, args) {}`

Emitted when a state machine exits into the `@exit` state.

#### Event: 'error'

`function (id, args) {}`

#### Event: 'warning'

`function (statename, evtname, description) {}`

A warning has been generated by the state machine

Emitted when a state machine exits into the `@error` state.

#### JSM.inject(evtname, args)

Directly inject an event into a state machine. Not recommended!


## JSMGraph

#### JSMGraph.draw(jsmfactory, callback)
#### JSMGraph.draw(jsmfactory, options, callback)
#### JSMGraph.draw_to_file(jsmfactory, filename)
#### JSMGraph.draw_to_file(jsmfactory, options, filename)

Draw the state machine.

In the case of `JSMGraph.draw()` the callback is called with the data for
the diagram. `JSMGraph.drawToFile()` is a helper function which automatically
writes the data to a file.

Options can be specified, including changing the diagram generator.





#### Event: ''

`function () {}`




